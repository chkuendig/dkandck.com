<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>ScrollTrigger - Scroll based animations with ease</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Erik Terwan">

    <link href="css/style.css" rel="stylesheet">
    <link href="css/demo.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Sacramento" rel="stylesheet">
    <script src="js/ScrollTrigger.min.js"></script>
    <script src="worldwind.js" type="text/javascript"></script>
    <script src="helloWorldWind.js" type="text/javascript"></script>
    <script src="CustomGoToAnimator.js" type="text/javascript"></script>
    <style>
        div#title {
        background-color: rgb(240, 242, 244);
    }
	#title h1{
        font-size: 5em;
        font-weight: normal;
		font-family: 'Sacramento', cursive;
		color: #000;
		margin:0;
		padding:0;
		top: 10%;
		position: relative;
		
		z-index: 99;
	}

#canvasOne {

width:100%;
height:100%;
}
#canvasContainer {
position:absolute;
top:50%;
left:0px;
z-index: 10;

width:100%;
height:50%;

/*transition:700ms ease-in-out;*/


}
#canvasContainer.globe {
    position:fixed;
top:10px;
left:10px;
width:250px;
height:250px;



z-index: 99;
}
</style>

    <script type="text/javascript">

        
        var tiltTimeout;
        // TODO: movoe animation functions to hellWorldWind
        var tiltAnim = function (step, goal, successCallback) {
            if (tiltTimeout) {
                clearTimeout(tiltTimeout)
            }
            var direction = "up"
            if (step < 0) {
                direction = "down"
                wwd.navigator.tilt = Math.max(wwd.navigator.tilt + step, goal);
            } else {

                wwd.navigator.tilt = Math.min(wwd.navigator.tilt + step, goal);
            }
            //	console.log(wwd.navigator.tilt)
            if ((wwd.navigator.tilt > goal && direction == "down") || (wwd.navigator.tilt < goal && direction == "up")) {
                tiltTimeout = setTimeout(function () { tiltAnim(step, goal, successCallback) }, 50);
            } else {
                successCallback()
            }
        }
        var zoomTimeout
        // https://github.com/NASAWorldWind/WebWorldWind/issues/734 (fix animation)
        var zoomAnim = function (step, goal, successCallback) {
            if (zoomTimeout) {
                clearTimeout(zoomTimeout)
            }
            var direction = "up"
            if (step < 0) {
                direction = "down"
                wwd.navigator.range = Math.max(wwd.navigator.range + step, goal);
            } else {
                wwd.navigator.range = Math.min(wwd.navigator.range + step, goal);
            }
            console.log(step)
            console.log(wwd.navigator.range)
            if ((wwd.navigator.range > goal && direction == "down") || (wwd.navigator.range < goal && direction == "up")) {
                zoomTimeout = setTimeout(function () { zoomAnim(step, goal, successCallback) }, 50);
            } else {
                successCallback()
            }
        }

        function showSection(section) {
            console.log("showSection: " + section)
            if (section == 0) {
                var element = document.getElementById("canvasContainer");
                element.classList.remove("globe");

                wwd.goToAnimator.goTo(new WorldWind.Location(30, -110));

                var frames = 700 / 50
                var zoom = 0.7e7
                zoomAnim((zoom / frames), zoom, function () {
                    console.log("done1")
                    tiltAnim((60 / frames), 60, function () {
                        console.log("done2")
                    })
                })

            }
        }
        function hideSection(section) {

            console.log("hideSection: " + section)
            if (section == 0) {

                var element = document.getElementById("canvasContainer");
                element.classList.add("globe");
                //  element.classList.add("active");
                // element.classList.add("moveDown");

                wwd.goToAnimator.goTo(new WorldWind.Location(47.36667, 8.55));

                var zoom = 4000
                zoomAnim((-1 * (wwd.navigator.range - zoom) / frames), zoom, function () {

                    var frames = 700 / 50
                    console.log(wwd.navigator.range)
                    tiltAnim(-1 * (wwd.navigator.tilt / frames), 0, function () {
                        console.log(wwd.navigator.range)
                        console.log("done5")
                    })
                })
            }
            console.log(section)
        }


    </script>
</head>

<body>
    <div id="canvasContainer">
        <canvas id="canvasOne">
            Your browser does not support HTML5 Canvas.
        </canvas>
        <div style="        width:100%;        height:100%;z-index:100;position:absolute;top:0;left:0"><!-- make sure to not allow any events to bubble to the globe--></div>

    </div>

    <div class="block" id="title">

        <h1 data-scroll="toggle(.scaleUpIn, .scaleUpOut)" data-scroll-showCallback="showSection(0)"
            data-scroll-hideCallback="hideSection(0)">Let us take you on a journey...</h1>

        <svg viewBox="0 0 60 60" style='z-index: 102;'>
            <path d="M52.254 18.327c0.816-0.804 2.127-0.804 2.937 0s0.813 2.103 0 2.907l-23.724 23.49c-0.81 0.804-2.121 0.804-2.937 0l-23.724-23.49c-0.81-0.804-0.81-2.103 0-2.907 0.813-0.804 2.127-0.804 2.937 0l22.257 21.423 22.254-21.423z"></path>
        </svg>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.fromTopIn, .fromTopOut)">CSS Animations</h1>
        <h2 data-scroll="toggle(.fromBottomIn, .fromBottomOut)">All animations are triggered by classes, so you can
            take advantage of the power that CSS3 animations give you.</h2>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.fromLeftIn, .fromLeftOut)">Vanilla JS</h1>
        <h2 data-scroll="toggle(.fromRightIn, .fromRightOut)">It's written in vanilla javascript, so you can use it
            with any framework.</h2>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.scaleDownIn, .scaleDownOut)">Request Animation Frame</h1>
        <h2 data-scroll="toggle(.fromBottomIn, .fromBottomOut)">It uses the window.requestAnimationFrame method so it
            doesn't jack the users scroll. Animations are triggered when the browser is ready for it.</h2>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.fromRightIn, .fromRightOut)">Simple syntax</h1>
        <h2 data-scroll="toggle(.fromLeftIn, .fromLeftOut)">You define the options inside the HTML attribute, so after
            you have initialised the ScrollTrigger you don't have to touch JavaScript again.</h2>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.fromRightIn, .fromRightOut)">Custom<span></span>izable</h1>
        <h2 data-scroll="toggle(.fromLeftIn, .fromLeftOut)">ScrollTrigger offers a range of options, from calling
            custom JavaScript functions to defining custom offsets and classes.</h2>
        <h3 data-scroll="toggle(.fromRightIn, .fromRightOut)" data-scroll-showCallback="counter">You scrolled past this
            block <span>0</span> times.</h3>
    </div>
    <div class="block">
        <h1 data-scroll="toggle(.fromRightIn, .fromRightOut) once">Versatile</h1>
        <h2 data-scroll="toggle(.fromLeftIn, .fromLeftOut) once">ScrollTrigger supports vertical and horizontal
            scrolling, check out the <a href="horizontal.html">horizontal demo</a>.</h2>
        <h3 data-scroll="toggle(.fromRightIn, .fromRightOut) once">This block only animates once.</h3>
    </div>
    <div class="block">
        <h1>Open source</h1>
        <h2>The project, with documentation, is on <a href="https://github.com/terwanerik/ScrollTrigger">GitHub</a>.
            Give it some love!</h2>
        <h3>Written by <a href="https://erikterwan.com" target="_blank">Erik Terwan</a></h3>
    </div>

    <script>
        window.counter = function () {
            // this refers to the html element with the data-scroll-showCallback tag
            var span = this.querySelector('span');
            var current = parseInt(span.textContent);

            span.textContent = current + 1;
        };

        document.addEventListener('DOMContentLoaded', function () {
            //  initializeMap()
        window.wwd =   launchGlobe();
            var trigger = new ScrollTrigger({
                addHeight: true
            });

            var loop = function (scrollLeft, scrollTop, width, height) {
                // you can do anything now with the height of the viewport
                // or the scrollPosition in the scrollElement.
                // if you are done with the callback you can detach it
                // using the ScrollTrigger.detach() method.
                var blockCnt = document.getElementsByClassName("block").length
                var pos = (scrollTop / height) / (blockCnt - 1)
             /*   console.log({ scrollLeft: scrollLeft, scrollTop: scrollTop, width: width, height: height, pos: pos,modulo:scrollTop%height })*/
             pageScroll=scrollTop%height
             page=(scrollTop-pageScroll)/height
             pageProgress=pageScroll/height

              //  console.log({page:page, pageProgress: pageProgress })
                //  jumpToPos(pos)
                /*var pos = 
                jumpToPos(pos)*/
                //trigger.detach(loop);
            };

            trigger.attach(loop);
        });
    </script>

    <link href="https://fonts.googleapis.com/css?family=Work+Sans:200,300,500,700" rel="stylesheet">
</body>

</html>